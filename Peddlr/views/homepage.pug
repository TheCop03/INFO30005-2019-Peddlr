extends default.pug
block css
    style
        include ../public/css/homepage.css

block user
    a(href = './signup')
        div.btn.from-middle Sign Up
    a(href = './login')
        div.btn.from-middle Log In
    a(href = './homepage')
        div.btn.from-middle.active Home

block content
    //form.searchbar(action='SEARCHRESULTS')
    div.searchzone
        h2 Let's Peddle
        a(href='./newlisting')
            button.createbutton(type='submit') + Create listing

        form(method = 'GET', action = '/search', autocomplete='off')
            input#searchbar(type='text', name = 'input', placeholder= "I am looking for...", list='datalist', autocomplete="off")
            datalist#datalist
            button.searchbutton(type='submit') Search
            i.fa.fa-search

    h3 Categories:

    div.categoryzone.menu-wrapper.menu
        each category in categories
            div.category.item
                a(href = `./listing/category/${category._id}`)
                    img.categoryphoto(src=category.photo alt=category.title)
                p.categorytitle #{category.title}

    h3 Latest Listings:

    div.latestlistingszone
        each listing in listings
            div.listing.dropup
                a(href = `./listing/id/${listing.id}`)
                    img.listingphoto(src=listing.photo alt=listing.title)
                    p.listingtitle #{listing.title}
                    div.dropup-content
                        p.listingdescription #{listing.description}

                    p.listingprice $#{listing.price} #{listing.interval}
                        div.dropup-content
                            p.listingdescription #{listing.description}


    script.
        function respFunction() {
            var x = document.getElementById("topNav");
            if (x.className === "header") {
                x.className += " responsive";
            } else {
                x.className = "header";
            }
        }

        document.getElementById("searchbar").addEventListener('keyup', () => {
            autocomplete(document.getElementById("searchbar").value);
        });

        function autocomplete(value) {
            if (value == "") {
                document.getElementById("datalist").innerHTML = "";
                return;
            }
            var xhttp = new XMLHttpRequest();

            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var result = JSON.parse(xhttp.responseText);
                    document.getElementById("datalist").innerHTML = "";
                    for (var i = 0; i < result.length; i++) {
                        var node = document.createElement("option");
                        var val = document.createTextNode(result[i].title);
                        node.appendChild(val);
                        document.getElementById("datalist").appendChild(node);
                    }
                }
            };

            xhttp.open("GET", "/searchlistings/" + value, true);
            xhttp.send();


        }

        function search() {
            var input = document.getElementById('searchbar').value;
            window.location.replace("./search/" + input);
        }